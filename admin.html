<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AdFlow Admin ‚Äî Lead Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #080D1A;
    --navy-mid: #0E1525;
    --navy-card: #121A2E;
    --navy-light: #172035;
    --lime: #C8FF00;
    --lime-dim: rgba(200,255,0,0.12);
    --lime-border: rgba(200,255,0,0.18);
    --white: #EFF2EC;
    --muted: #5A6478;
    --muted-light: #8892A4;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    background: var(--navy);
    color: var(--white);
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    line-height: 1.5;
    min-height: 100vh;
  }

  /* Login Screen */
  .login-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .login-box {
    background: var(--navy-card);
    border: 1px solid var(--lime-border);
    padding: 48px 40px;
    max-width: 400px;
    width: 100%;
    text-align: center;
  }

  .login-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    letter-spacing: 0.1em;
    margin-bottom: 8px;
  }

  .login-logo em { color: var(--lime); font-style: normal; }

  .login-subtitle {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 32px;
  }

  .login-input {
    width: 100%;
    background: var(--navy-light);
    border: 1px solid rgba(200,255,0,0.1);
    color: var(--white);
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    padding: 14px 18px;
    margin-bottom: 16px;
    text-align: center;
    letter-spacing: 0.1em;
  }

  .login-input:focus {
    outline: none;
    border-color: var(--lime);
  }

  .login-input::placeholder {
    color: var(--muted);
    letter-spacing: 0.05em;
  }

  .login-btn {
    width: 100%;
    background: var(--lime);
    color: var(--navy);
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 16px;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
  }

  .login-btn:hover { background: #b8ef00; }

  .login-error {
    color: #ff6b6b;
    font-size: 13px;
    margin-top: 16px;
    display: none;
  }

  /* Dashboard */
  .dashboard {
    display: none;
    min-height: 100vh;
  }

  .dashboard.active {
    display: block;
  }

  .header {
    background: var(--navy-mid);
    border-bottom: 1px solid rgba(200,255,0,0.1);
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 24px;
    letter-spacing: 0.1em;
  }

  .header-logo em { color: var(--lime); font-style: normal; }

  .header-right {
    display: flex;
    align-items: center;
    gap: 24px;
  }

  .header-stats {
    display: flex;
    gap: 24px;
  }

  .stat-item {
    text-align: right;
  }

  .stat-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 28px;
    color: var(--lime);
    line-height: 1;
  }

  .stat-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .logout-btn {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.15);
    color: var(--muted-light);
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 8px 16px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .logout-btn:hover {
    border-color: var(--lime-border);
    color: var(--white);
  }

  .main {
    padding: 32px;
  }

  .filters {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .filter-btn {
    background: var(--navy-card);
    border: 1px solid rgba(200,255,0,0.1);
    color: var(--muted-light);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 10px 18px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .filter-btn:hover {
    border-color: rgba(200,255,0,0.3);
    color: var(--white);
  }

  .filter-btn.active {
    background: var(--lime-dim);
    border-color: var(--lime-border);
    color: var(--lime);
  }

  .leads-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--navy-card);
    border: 1px solid rgba(200,255,0,0.1);
  }

  .leads-table th {
    background: var(--navy-mid);
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 400;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--lime);
    padding: 14px 16px;
    text-align: left;
    border-bottom: 1px solid rgba(200,255,0,0.1);
  }

  .leads-table td {
    padding: 16px;
    border-bottom: 1px solid rgba(200,255,0,0.05);
    vertical-align: top;
  }

  .leads-table tr:hover {
    background: rgba(200,255,0,0.02);
  }

  .lead-name {
    font-weight: 600;
    color: var(--white);
    margin-bottom: 2px;
  }

  .lead-email {
    font-size: 13px;
    color: var(--muted-light);
  }

  .lead-email a {
    color: var(--muted-light);
    text-decoration: none;
  }

  .lead-email a:hover {
    color: var(--lime);
  }

  .lead-website a {
    color: var(--muted-light);
    text-decoration: none;
    font-size: 13px;
    word-break: break-all;
  }

  .lead-website a:hover {
    color: var(--lime);
  }

  .badge {
    display: inline-block;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 5px 10px;
    border-radius: 3px;
  }

  .badge-spend-low {
    background: rgba(150,150,150,0.2);
    color: #999;
  }

  .badge-spend-mid {
    background: rgba(34,197,94,0.15);
    color: #22c55e;
  }

  .badge-spend-high {
    background: var(--lime-dim);
    color: var(--lime);
  }

  .status-select {
    background: var(--navy-light);
    border: 1px solid rgba(200,255,0,0.15);
    color: var(--white);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.05em;
    padding: 8px 12px;
    cursor: pointer;
    min-width: 120px;
  }

  .status-select:focus {
    outline: none;
    border-color: var(--lime);
  }

  .status-select option {
    background: var(--navy);
  }

  .status-new { border-left: 3px solid #60a5fa; }
  .status-contacted { border-left: 3px solid #fbbf24; }
  .status-qualified { border-left: 3px solid #22c55e; }
  .status-closed { border-left: 3px solid var(--lime); }
  .status-rejected { border-left: 3px solid #ef4444; }

  .lead-bottleneck {
    font-size: 13px;
    color: var(--muted-light);
    max-width: 250px;
    line-height: 1.5;
  }

  .lead-date {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
  }

  .empty-state {
    text-align: center;
    padding: 80px 40px;
    color: var(--muted);
  }

  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }

  .loading {
    text-align: center;
    padding: 60px;
    color: var(--muted);
  }

  .toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: var(--lime);
    color: var(--navy);
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.05em;
    padding: 14px 24px;
    border-radius: 4px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s;
  }

  .toast.show {
    transform: translateY(0);
    opacity: 1;
  }

  @media (max-width: 1024px) {
    .leads-table {
      display: block;
      overflow-x: auto;
    }
  }

  @media (max-width: 768px) {
    .header {
      flex-direction: column;
      gap: 16px;
      padding: 16px;
    }
    .header-stats {
      gap: 16px;
    }
    .main {
      padding: 16px;
    }
    .filters {
      gap: 8px;
    }
    .filter-btn {
      padding: 8px 12px;
      font-size: 10px;
    }
  }
</style>
</head>
<body>

<!-- Login Screen -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="login-logo">Ad<em>Flow</em></div>
    <div class="login-subtitle">Admin Dashboard</div>
    <input type="password" class="login-input" id="passwordInput" placeholder="Enter password" autofocus>
    <button class="login-btn" onclick="attemptLogin()">Access Dashboard</button>
    <div class="login-error" id="loginError">Incorrect password</div>
  </div>
</div>

<!-- Dashboard -->
<div class="dashboard" id="dashboard">
  <header class="header">
    <div class="header-logo">Ad<em>Flow</em> Admin</div>
    <div class="header-right">
      <div class="header-stats">
        <div class="stat-item">
          <div class="stat-value" id="totalLeads">-</div>
          <div class="stat-label">Total Leads</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="qualifiedLeads">-</div>
          <div class="stat-label">Qualified</div>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </header>

  <main class="main">
    <div class="filters">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="new">New</button>
      <button class="filter-btn" data-filter="contacted">Contacted</button>
      <button class="filter-btn" data-filter="qualified">Qualified</button>
      <button class="filter-btn" data-filter="closed">Closed</button>
      <button class="filter-btn" data-filter="rejected">Rejected</button>
    </div>

    <div id="leadsContainer">
      <div class="loading">Loading leads...</div>
    </div>
  </main>
</div>

<div class="toast" id="toast">Status updated</div>

<script>
  // Config
  const SUPABASE_URL = 'https://ykmdpxtnmqkfcscmmjfv.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlrbWRweHRubXFrZmNzY21tamZ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDc0OTMsImV4cCI6MjA4NzE4MzQ5M30.EfvqLYzRdNitCpqrYlrytYwcry6T1CuGUgGzE4ZXU7Q';
  const ADMIN_PASSWORD = 'adflow2024';

  let allLeads = [];
  let currentFilter = 'all';

  // Check if already logged in
  if (sessionStorage.getItem('adflow_admin') === 'true') {
    showDashboard();
  }

  // Login
  function attemptLogin() {
    const password = document.getElementById('passwordInput').value;
    if (password === ADMIN_PASSWORD) {
      sessionStorage.setItem('adflow_admin', 'true');
      showDashboard();
    } else {
      document.getElementById('loginError').style.display = 'block';
      document.getElementById('passwordInput').value = '';
    }
  }

  document.getElementById('passwordInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') attemptLogin();
  });

  function showDashboard() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboard').classList.add('active');
    loadLeads();
  }

  function logout() {
    sessionStorage.removeItem('adflow_admin');
    location.reload();
  }

  // Load leads from Supabase
  async function loadLeads() {
    try {
      const response = await fetch(`${SUPABASE_URL}/rest/v1/leads?select=*&order=created_at.desc`, {
        headers: {
          'apikey': SUPABASE_KEY,
          'Authorization': `Bearer ${SUPABASE_KEY}`
        }
      });
      
      allLeads = await response.json();
      updateStats();
      renderLeads();
    } catch (error) {
      console.error('Error loading leads:', error);
      document.getElementById('leadsContainer').innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div>Error loading leads</div>';
    }
  }

  function updateStats() {
    document.getElementById('totalLeads').textContent = allLeads.length;
    document.getElementById('qualifiedLeads').textContent = allLeads.filter(l => l.status === 'qualified' || l.status === 'closed').length;
  }

  function renderLeads() {
    const container = document.getElementById('leadsContainer');
    const filtered = currentFilter === 'all' ? allLeads : allLeads.filter(l => l.status === currentFilter);

    if (filtered.length === 0) {
      container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div>No leads found</div>';
      return;
    }

    container.innerHTML = `
      <table class="leads-table">
        <thead>
          <tr>
            <th>Contact</th>
            <th>Website</th>
            <th>Spend</th>
            <th>Setup</th>
            <th>Bottleneck</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          ${filtered.map(lead => `
            <tr class="status-${lead.status || 'new'}">
              <td>
                <div class="lead-name">${escapeHtml(lead.name)}</div>
                <div class="lead-email"><a href="mailto:${escapeHtml(lead.email)}">${escapeHtml(lead.email)}</a></div>
              </td>
              <td class="lead-website">
                ${lead.website ? `<a href="${escapeHtml(lead.website)}" target="_blank">${escapeHtml(lead.website.replace(/^https?:\/\//, ''))}</a>` : '-'}
              </td>
              <td><span class="badge ${getSpendClass(lead.monthly_spend)}">${formatSpend(lead.monthly_spend)}</span></td>
              <td style="font-size:13px; color:var(--muted-light);">${formatSetup(lead.creative_setup)}</td>
              <td class="lead-bottleneck">${escapeHtml(lead.bottleneck || '-')}</td>
              <td>
                <select class="status-select" onchange="updateStatus('${lead.id}', this.value)">
                  <option value="new" ${lead.status === 'new' ? 'selected' : ''}>New</option>
                  <option value="contacted" ${lead.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                  <option value="qualified" ${lead.status === 'qualified' ? 'selected' : ''}>Qualified</option>
                  <option value="closed" ${lead.status === 'closed' ? 'selected' : ''}>Closed</option>
                  <option value="rejected" ${lead.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                </select>
              </td>
              <td class="lead-date">${formatDate(lead.created_at)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  }

  // Update status
  async function updateStatus(id, status) {
    try {
      await fetch(`${SUPABASE_URL}/rest/v1/leads?id=eq.${id}`, {
        method: 'PATCH',
        headers: {
          'apikey': SUPABASE_KEY,
          'Authorization': `Bearer ${SUPABASE_KEY}`,
          'Content-Type': 'application/json',
          'Prefer': 'return=minimal'
        },
        body: JSON.stringify({ status })
      });

      // Update local data
      const lead = allLeads.find(l => l.id === id);
      if (lead) lead.status = status;
      
      updateStats();
      renderLeads();
      showToast('Status updated');
    } catch (error) {
      console.error('Error updating status:', error);
      showToast('Error updating status');
    }
  }

  // Filters
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.dataset.filter;
      renderLeads();
    });
  });

  // Helpers
  function formatSpend(spend) {
    const labels = {
      'under-5k': '<$5K',
      '5k-15k': '$5K-15K',
      '15k-30k': '$15K-30K',
      '30k-50k': '$30K-50K',
      '50k-plus': '$50K+'
    };
    return labels[spend] || spend || '-';
  }

  function getSpendClass(spend) {
    if (spend === '30k-50k' || spend === '50k-plus') return 'badge-spend-high';
    if (spend === '5k-15k' || spend === '15k-30k') return 'badge-spend-mid';
    return 'badge-spend-low';
  }

  function formatSetup(setup) {
    const labels = {
      'in-house': 'In-house',
      'agency': 'Agency',
      'freelancers': 'Freelancers',
      'myself': 'DIY',
      'mix': 'Mix'
    };
    return labels[setup] || setup || '-';
  }

  function formatDate(dateStr) {
    if (!dateStr) return '-';
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
  }

  function escapeHtml(str) {
    if (!str) return '';
    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }

  function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2000);
  }
</script>
</body>
</html>
